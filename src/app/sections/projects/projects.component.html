<section id="projects" class="w-full min-w-0 py-20 lg:py-28 bg-slate-50">
  <div class="w-full max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <span class="inline-block bg-slate-200 text-slate-700 text-sm font-semibold px-4 py-2 rounded-full mb-4">Portafolio</span>
      <h2 class="text-3xl lg:text-4xl font-bold text-slate-800 mb-4">Proyectos realizados</h2>
      <p class="text-slate-600 text-lg max-w-2xl mx-auto">Algunos de los trabajos que hemos desarrollado para empresas líderes en el sector industrial. Haz clic en cualquier proyecto para ver más fotos y detalles.</p>
    </div>

    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-3 lg:gap-4">
      @for (proyecto of proyectos; track proyecto.titulo; let i = $index) {
        <button type="button"
                class="project-card group relative block overflow-hidden rounded-xl aspect-[4/3] focus:outline-none focus-visible:ring-2 focus-visible:ring-red-500 focus-visible:ring-offset-2 text-left"
                (click)="abrirModal(i)">
          <img [src]="proyecto.imagenes[0]" [alt]="proyecto.titulo"
               class="project-thumb w-full h-full object-cover transition-transform duration-500 group-hover:scale-110">
          <div class="absolute inset-0 bg-gradient-to-t from-slate-900/90 via-slate-900/40 to-transparent flex items-end p-3 sm:p-4">
            <span class="text-white font-semibold text-xs sm:text-sm line-clamp-2">{{ proyecto.titulo }}</span>
          </div>
        </button>
      }
    </div>

    <div class="text-center mt-12">
      <a href="#contact" class="inline-flex items-center bg-red-600 hover:bg-red-700 text-white font-semibold px-8 py-3 rounded-lg transition-all hover:shadow-lg hover:shadow-red-600/25">
        ¿Tienes un proyecto en mente?
        <svg class="w-5 h-5 ml-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
        </svg>
      </a>
    </div>
  </div>
</section>

<!-- Modal detalle proyecto -->
@if (modalAbierto) {
  <div class="fixed inset-0 z-[100] flex items-center justify-center p-4 bg-slate-900/80 transition-opacity duration-300"
       (click)="cerrarModal()"
       role="dialog"
       aria-modal="true"
       [attr.aria-labelledby]="'modal-proyecto-titulo'">
    <div class="bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col overflow-hidden border border-slate-200"
         (click)="$event.stopPropagation()">
      <div class="flex items-center justify-between p-4 sm:p-6 border-b border-slate-100 flex-shrink-0">
        <h2 [id]="'modal-proyecto-titulo'" class="text-xl sm:text-2xl font-bold text-slate-800 truncate pr-4">
          {{ proyectoSeleccionado?.titulo }}
        </h2>
        <button type="button" (click)="cerrarModal()" class="p-2 rounded-lg text-slate-500 hover:bg-slate-100 hover:text-slate-700 transition-colors" aria-label="Cerrar">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/></svg>
        </button>
      </div>
      <div class="relative flex-shrink-0 bg-slate-100">
        <div class="aspect-video w-full overflow-hidden rounded-none bg-slate-200">
          <img [src]="proyectoSeleccionado?.imagenes?.[imagenIndex] ?? ''" [alt]="proyectoSeleccionado?.titulo ?? ''" class="w-full h-full object-contain">
        </div>
        @if (proyectoSeleccionado && proyectoSeleccionado.imagenes.length > 1) {
          <button type="button" (click)="imgAnterior(); $event.stopPropagation()" class="absolute left-2 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/90 shadow-lg flex items-center justify-center text-slate-700 hover:bg-white transition-colors" aria-label="Foto anterior">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          </button>
          <button type="button" (click)="imgSiguiente(); $event.stopPropagation()" class="absolute right-2 top-1/2 -translate-y-1/2 w-10 h-10 rounded-full bg-white/90 shadow-lg flex items-center justify-center text-slate-700 hover:bg-white transition-colors" aria-label="Siguiente foto">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
          </button>
        }
      </div>
      <div class="p-4 sm:p-6 overflow-y-auto flex-1">
        @if (proyectoSeleccionado) {
          <dl class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 mb-4">
            <div class="flex items-start gap-3">
              <dt class="text-slate-500 text-sm font-medium flex-shrink-0">Empresa</dt>
              <dd class="text-slate-800 font-semibold text-sm sm:text-base">{{ proyectoSeleccionado.empresa }}</dd>
            </div>
            <div class="flex items-start gap-3">
              <dt class="text-slate-500 text-sm font-medium flex-shrink-0">Lugar</dt>
              <dd class="text-slate-800 text-sm sm:text-base">{{ proyectoSeleccionado.lugar }}</dd>
            </div>
            <div class="sm:col-span-2 flex items-start gap-3">
              <dt class="text-slate-500 text-sm font-medium flex-shrink-0">Año</dt>
              <dd class="text-slate-800 text-sm sm:text-base">{{ proyectoSeleccionado.ano }}</dd>
            </div>
          </dl>
          <p class="text-slate-600 text-sm sm:text-base leading-relaxed">{{ proyectoSeleccionado.descripcion }}</p>
        }
      </div>
      <div class="flex items-center justify-between p-4 sm:p-6 border-t border-slate-100 flex-shrink-0 bg-slate-50">
        <button type="button" (click)="proyectoAnterior(); $event.stopPropagation()" [class.invisible]="proyectoIndex === 0" class="inline-flex items-center text-slate-600 hover:text-red-600 font-medium text-sm transition-colors">
          <svg class="w-5 h-5 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/></svg>
          Anterior
        </button>
        <span class="text-slate-500 text-sm font-medium">{{ proyectoIndex + 1 }} / {{ proyectos.length }}</span>
        <button type="button" (click)="proyectoSiguiente(); $event.stopPropagation()" [class.invisible]="proyectoIndex === proyectos.length - 1" class="inline-flex items-center text-slate-600 hover:text-red-600 font-medium text-sm transition-colors">
          Siguiente
          <svg class="w-5 h-5 ml-1" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7"/></svg>
        </button>
      </div>
    </div>
  </div>
}
